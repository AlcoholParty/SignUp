<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원가입 페이지</title>
</head>
<body>
    <form action="/joinform/join" method="post" th:object="${memberDTO}">
        <input name="platform" type="hidden" value="Soju">
        <input name="roleName" type="hidden" value="USER">
        <input id="hEmailCheck" type="text">
        <input id="hEmailKey" type="text">
        <input id="hNickname" type="text">
        <ul>
            <li><label>아이디 </label><input th:field="*{emailId}" type="text">
                <input type="button" value="인증번호 전송" onclick="sendEmail(this.form)"></li>
            <li><label>인증번호 입력 </label><input id="emailKey" type="text">
                <input type="button" value="인증번호 확인" onclick="checkNum()"></li>

            <li><label>비밀번호 </label><input th:field="*{pwd}" type="password" oninput="pwdCheck(this.form)"><br></li>
            <li><label id="pwdText1" style="color:red"></label></li>
            <li><label>비밀번호 확인 </label><input id="pwd2" type="password" oninput="pwdCheck2(this.form)"><br></li>
            <li><label id="pwdText2"></label></li>

            <li><label>이름 </label><input th:field="*{name}" type="text"></li>

            <li><label>닉네임(별명) </label><input th:field="*{nickname}" type="text">
                <input type="button" value="중복확인" onclick="checkNickname(this.form)"><br></li>
            <li><label id="nicknameCheck"></label></li>

            <li><label>생일 </label><input th:field="*{birthday}" type="date"></li>

            <li><label>성별 </label><label>남</label><input th:field="*{gender}" type="radio" value="M">
                                   <label>여</label><input th:field="*{gender}" type="radio" value="W"></li>

            <li><label>휴대전화 </label><input th:field="*{phoneNumber}" type="tel"></li>

            <li><label>주소 </label><input th:field="*{address}" type="text">
            <input id="btnAddress" type="button" value="주소찾기"></li>
            <li><label>상세주소 </label><input th:field="*{detailAddress}" type="text"></li>

            <li><label>관심분야 </label><select th:field="*{studyType}"><option value="">관심분야</option>
                                                                      <option value="computer">컴퓨터 / IT</option>
                                                                      <option value="math">수학</option>
                                                                      <option value="management">경영 / 마케팅</option>
                                                                      <option value="design">디자인</option>
                                                                      <option value="education">교육</option>
                                                                      <option value="literature">문학</option>
                                                                      <option value="game">게임</option>
                                                                      <option value="engineering">공학</option>
                                                                      <option value="language">언어</option>
                                                                      <option value="employment">취업</option>
                                                                      <option value="entrance">입시</option>
                                                                      <option value="etc">기타</option></select></li>
        </ul>
        <input type="submit" value="가입하기">
    </form>
<!--JS----------------------------------------------------------------------------------------------------------------->
    <!-- Ajax 사용을 위한 js를 추가 -->
    <script src="/js/httpRequest.js"></script>
    <script>
    //이메일 중복값 확인 및 인증번호 전송
        function sendEmail(f) {
            let emailId = f.emailId.value; //이메일 입력값 가져오기

            let url = "/joinform/emailcheck";
            let param = "emailId=" + emailId;
            sendRequest(url, param, resultSendEmail, "POST");
        }

        function resultSendEmail() {
            if ( xhr.readyState == 4 && xhr.status == 200 ) {
                let data = xhr.responseText; //email check 값
                let hEmailCheck = document.getElementById("hEmailCheck"); //중복체크용 값
                let hEmailKey = document.getElementById("hEmailKey"); //이메일키 확인

                if ( data == "no" ) {
                    alert("이미 존재하는 아이디입니다.");
                    hEmailCheck.value = "false";
                    return;
                } else {
                    alert("인증메일을 전송했습니다.");
                    hEmailKey.value = data;
                    return;
                }
            }
        }

        function checkNum() {
            let emailKey = document.getElementById("emailKey");
            let hEmailKey = document.getElementById("hEmailKey");
            let hEmailCheck = document.getElementById("hEmailCheck");

            if ( emailKey.value == hEmailKey.value ) {
                alert("인증되었습니다.");
                hEmailCheck.value = "true"; //이메일체크값 밸류변경
                emailKey.readOnly = true;
                return;
            } else {
                alert("인증번호를 다시 확인해주세요");
                hEmailCheck.value = "false";
                emailKey.value = "";
                return;
            }
        }
    </script>

    <script>
    //닉네임 중복체크 및 글자 수 제한
        function checkNickname(f) {
            let nickname = f.nickname.value; //입력한 닉네임 가져오기
            let nicknameCheck = document.getElementById("nicknameCheck");

            if ( nickname.length > 20 ) {
                nicknameCheck.innerHTML = "닉네임은 10자내로 작성해주세요 (영문만 작성시 20자까지 가능합니다.)";
            } else {
                nicknameCheck.innerHTML = "";
                let url = "/joinform/nicknamecheck";
                let param = "nickname=" + nickname;
                sendRequest(url, param, resultCheckNickname, "POST");
            }
        }

        function resultCheckNickname() {
             if ( xhr.readyState == 4 && xhr.status == 200 ) {
                 let data = xhr.responseText; //닉네임
                 let hNickname = document.getElementById("hNickname");

                 if ( data == "no" ) {
                    alert("이미 존재하는 닉네임입니다.");
                    hNickname.value = "false";
                 } else {
                    alert("사용 가능한 닉네임입니다.");
                    hNickname.value = data;
                 }
                 return;
             }
        }
    </script>
    <script>
    //비밀번호 형식 제한
        function pwdCheck(f) {
            let pwd = f.pwd.value;
            let pwdText1 = document.getElementById("pwdText1");

            let pattern1 = /[0-9]/; // 숫자 입력
			let pattern2 = /[a-zA-Z]/; // 영어 소문자, 대문자 입력
			let pattern3 = /[~!@#$%^&*()_+]/; // 특수기호 입력

			if ( !pattern1.test(pwd) || !pattern2.test(pwd) || !pattern3.test(pwd) || pwd.length < 5 ) {
			    pwdText1.innerHTML = "영문, 숫자, 특수기호(~!@#$%^&*()_+)를 포함하여 5자리 이상으로 구성하여야 합니다";
			} else {
			    pwdText1.innerHTML = "";
			}
        }

        function pwdCheck2(f) {
            let pwd = f.pwd.value;
            let pwd2 = f.pwd2.value;
            let pwdText2 = document.getElementById("pwdText2");

            if ( pwd2 != pwd ) {
                pwdText2.innerHTML = "비밀번호가 일치하지 않습니다";
            } else {
                pwdText2.innerHTML = "";
            }
        }
    </script>

    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
    //주소 API
        window.onload = function() {
            document.getElementById("address").addEventListener("click", function() {
                new daum.Postcode({
                    oncomplete: function(data) {
                        document.getElementById("address").value = data.address;
                        document.getElementById("detailAddress").focus();
                    }
                }).open();
            });
            document.getElementById("btnAddress").addEventListener("click", function() {
                new daum.Postcode({
                    oncomplete: function(data) {
                        document.getElementById("address").value = data.address;
                        document.getElementById("detailAddress").focus();
                    }
                }).open();
            });
        }
    </script>
</body>
</html>